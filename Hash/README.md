# Hash and Checksum

TO BE EDITTED

We are going to first look at what is a checksum and what is hash algorithm.
Next we are going to talk about the hash function applications.
At last we are going to discuss hands-on.

## Checksum and Hash Algorithm

Let's look at the idea.
The goal of a hash algorithm is pretty simple.
Given a message of whatever the length,
when this message goes through the hash function, the output is always of fixed length.
For example there is a hash algorithm called md5.
Its output is always a 128 bits, which are 16 bytes.
Since there are unlimited number of messages in the world and the output of a hash function is of fixed length,
multiple messages can be mapped to one possible hash.

<img src="../Imgs/HashAlgorithm.png" width=360>

The hash algorithm has a few other names
- Message digest. Apparently after the hash algorithm, the message is condensed into message hash. It is like potatoes are made into hash browns. Hash browns do not look like potatoes at all.
- One-way transformation/One-way function. It's called a one-way transformation or function because you can produce message hash from a message. But from message hash, you cannot recover the original message. So it's one way. 

Length of message hash H(m) is generally shorter than length of message m. Message hash are usually of fixed lengths depending on the hash algorithm. For example, MD5 hash is 128 bit (16 bytes) and SHA1 hash is 160 bits (20 bytes).

## Example Application: Hash as Message/File Identity

People may hash a file and use the file hash as the identity of the file.
But apparently there is some issue here since we said multiple messages/files can be hashed into the same hash value.
However people are still doing this for a reason. Why?
So the question is what is the change that files have the same hash?
You many files on your disk. If you use MD5 to hash each file, what is the probability that two files have the same hash?

## Birthday Problem

Given a message, a good hash algorithm may produce a rather random hash value.
We can assume the hash value is randomly generated by a good hash algorithm.
Then the problem that two files have the same hash is similar to the birthday problem.
The birthday problem is: What is the probability that in a set of n randomly chosen people, at least one pair of them will have the same birthday?
Assume a year has 365 days.

<img src="../Imgs/BirthdayProblem.png" width=420>

Now let's calculate the probability that all n people have different birthdays. 
We first answer this question: How many combinations of putting n people into 365 days/slots with no two people in the same day/slot?
We first pick up a person: she could be put into any of the 365 days. Given her birthday is fixed, the second person can be put into 365-1=364 days. We can deal with other people similarly. Therefore, the number of combinations is 365 &times; 364 &times; … &times; (365-n+1).

We now answer the second question: How many combinations of putting n people into 365 slots? In this case, we do not care about if two people may have the same birthday. Every person can be put into one of 365 days. Therefore, the number of combinations of putting n people into 365 slots is
365<sup>n</sup>.

Now we can answer:
What is the chance that n people all have different birthdays? It can be calcualted as follows

P=365 &times; 364 &times; … &times; (365−n+1) / 365<sup>n</sup> 

Now we can answer:
What is the chance that at least two people out of n people have the same birthday assuming a year has 365 days? It can be calculated as follows

1-P = 365 &times; 364 &times; … &times; (365−n+1) / 365<sup>n</sup> 

The figure belows shows The computed probability of at least two people sharing a birthday versus the number of people.

<img src="../Imgs/BirthdayProblemProbability.png" width=360>

Now let's look at the probability that two files on a hard disk having the same probability. 
MD5 hash algorithm has 2<sup>128</sup> possible hash values. That is about 3.4 &times 10<sup>38</sup>.
My hard disk has 152,094 files.
What is the probability that at least two of 152,094 files have the same hash value out of 3.4 &times 10<sup>38</sup> possible hash values? Apparently it is extremely small. That is why the file hash can be used as the identify of the file.

Here are desirable properties of hash functions
- Performance: It shall be easy to compute message hash H(m)
- One-way property: Given message hash H(m), it’s difficult to find the original message m

For the one way property, there are two different levels of difficulity in terms of finding m given H(m)
- Weak collision free: Given H(m), it’s difficult to find a message m' such that H(m') = H(m).
- Strong collision free: It's computationally infeasible to find two messages m1 and m2 such that H(m1) = H(m2)

## Discussion

- Can you design a hash algorithm?

- Can you design a good hash algorithm?


## Internet checksum

Before hash, people used something called Internet checksum for integrity.
We are still using this today whenever you send out Internet packets for various reasons.
Internet checksum has some properties of hash function:
- produces fixed length digest of message
- is many-to-one
But given message with given checksum value, it is easy to find another message with same checksum value.

However, we have the checksum so which checks down so let's look at the message here
the message is i owe you 100.99
million dollars thanks i don't know so so if
we actually map the curtains here
to final numbers to ask a code right supposing i i use i mean sorry 49 is used to refer
to r for i not talking about clone 9 okay this is
actually highest no but anyway call f refers to o
so basically like this and uh so there are checksum algorithm it's very
similar to a hash aggregate we just added all the columns together
you can see in this way we can however whatever the message
our checksum is always four bytes by four characters right
because we use two numbers here to represent one chapter so this is good
right this means the requirement of the hash axis right and is the the lens however
is this approach good so you just add them together this is a
hexadecimal and then you just just assume this is the second number whatever and uh you add
them together if this happens you produce one you have this column you improve this you add this
column you produce this so if we look at
the right side here this tells you this approach is not good it's very easy
to produce tradition why
go ahead in the same column
that's right right you can see right for the sim column here you just actually switch the
[Music] internet checksum is not very good it's not cryptographically
hash function we are not graphical algorithms okay and uh
if when we talk about the cryptographic hash function we talk
about those problems okay good so far so good okay
and uh so now let's look at the applications of uh hash
algorithms the first one is a possibility
when you actually use your computers right
you can actually enter your password then you can log into your computer as
you do on our pc here anybody knows how
passwords are saved on a computer because the computer must
see your password so that when you enter your password the computer will actually check your
password and uh see if the password is saved somewhere it's the same as uh the one that a
computer stores is that right so that computer can assign you
anybody knows how passwords are saved on
a computer you have to speak loudly
okay yeah shadow is right anybody here mouse
knows the question is how does a computer
store your password so for example when you use our computer
right when you tap student one as username
server security as a password the computer will allow you studying but if you have the wrong password the
computer doesn't allow you to get in that means the computer must
have stored your password in some format on the computer so that it can use the
stored password to check you right and uh so my question is
how does a computer store your password
in plain text or you know what actually i'll tell you the answer
see that's a good answer but i heard of encryption over there
that's another idea okay
so this is the procedure let's see here right carol here she wants to log into the
computer okay and uh what she will do is she will provide her username camera she will
provide her password okay the computer will receive
her lovely information username customer
actually has a database and this database could be implemented as a file
but this basically you store the data in about the same idea so
the computer actually stores people's password in this format
first username and there's something called a swap it's just some extra security but it really
doesn't matter to our understanding then for example
in all time these use the sd file cache language which refers to md file cache
to hash the concatenated camera password and
the song okay so basically this is the format
of a password in a computer why do we do that the reason is you can
see here when a software provider a server like our
china server has a vulnerabilities hackers can get into the server they may
steal your database of a password if you do not actually
catch them they will see your password immediately that's too dangerous
right and uh however if you actually
store your password as password and caches then they cannot see they have to find a
way to find the password that's not easy and uh so that's why we see
password not in slim text but in the format of a tax
but did not increase because the hash is not increasing okay
and uh so the country is not good in this case because you have to save the encryption
key on the face so if the attacker knows the encryption key right you search around on your face doesn't find that
you're you're inputting key then when you put the password
right and anybody heard of a password cracking is actually possible to crash
quite a hashtag anybody heard of a password hash tracking or possible cracking
do you know what is the principle um
yes i know that's the goal what is the mechanic then tracking password oh so basically
the assumption is like you guys you type into my type of server then you can actually do
anything you want it alright and then you can get a database and you gotta think this above password hashes
but uh when you can't have password hashes like this how can you find
the corresponding password here the thought here is a clear it's plain text
okay only this part is a possible hash
um running the hash function
passwords accessories very good the principle is simple
so when you actually click your password many people use like adc one two three one two three four
five or six thousand and using your birthday use your parents birthday you
will use your friend's birthday and uh and also when people create a password normally they use eight characters or
with something okay so basically here's
how hackers procrastinate the password package
because there's a rule generating the password
based on the rule the number of a password is limited is that right
like for example if for your ipad
you can use six digits right and uh each data can be zero to nine tell me
how many possible pass codes can you have on ipad
so actually six figures right one two three four five
six this can be a zero to nine zero to nine zero to nine
zero to nine zero so tell me this is a
your ipad passcode how many possible possibles can you have
based on this password creation rule
60 so this is 10 right 10 possibilities 10 possibilities 10 possibilities 10
positive similarities 10 possibilities what's the number of combinations
uh you are actually right one minute so it's basically
10 to the power of 6. so let's see the attacker gets your
password hash stored on your ipad tell me a way
the attacker can use to crack to sign your password original password
go ahead well like find the hashes
you can try you can cache all the passcodes right
and see which one is equal to the same with the password hash then you'll find the passcode
that's called a brute force attack but normally attackers don't do that and
uh on the black market on internet
you can buy something called a wine on password database
so the database sales popular passwords with different potentials
for example if you look at the password that is sold on the internet
you will find out there are many onenote passwords like a abc123
one to nine and uh for example also password as a password and people often
use those passwords as their password because they are lazy you cannot remember good password right and uh
so most of the passwords are cracking too they first try
the you know popular password saved upon that at least first if they cannot
expand oh none of uh the popular password is used as the password
we will just try to enumerate all possible all possible passwords with some popular rule and see
which one actually produces uh the same hash
on the disk so that's called the password crash any question here good
okay today one time gone is a crack a password hash
but uh my password hash corresponding to a known
password it takes maybe like one millisecond to get it
because the computer does not very fast right i mean you give it a go then it does the calculation very fast
so that's called the password of cracking okay and uh
so now let's look at the massive integrity code so then here here let's look at this right
and uh so but we have a camera here we have a bubble here
and we want to use a hash as the message integrity code so basically when clara sent out
message she sent the message she also has the message get a message
okay so now he's under these two parts message and message cash to bob
so when probably save it bubble can actually compute the hash of the received message
and compare the newly consumed message hash with the transmitted domestic cash if they
are equal the message is not changed right is that good
good you don't look good right okay let's see let's see now we have an attacker here
so let's see this is the guy in the middle he can actually
intercept message and then he can change the message then send the teach the message and
message that to one okay so my question is if we have such a
powerful anime in the middle
thus message hash still work as message integrity
code why not so they can change the message and
change the hacks right and they understand that the change dramatic and the achievements
hash to bob one bobber it bubble actually just has this
new message and compared with the contributor messaging they are the same
is that right they are the same so you can see here message hash itself
cannot be used for message authentication or message integrity checking
that's why we need something called a cheater cache okay so i give you two minutes to discuss
with your group and tell me instead of sending
the message hash now kara and bob they share a key
and uh so they know the safety right so carol will send out a message this way the message
and uh the cache of a message and the key here
so will this defeat the powerful attacker that's my question you can discuss with
your group for two minutes
[Music]
the eve doesn't know the key okay the u doesn't know the key
oh
the key basically just run the number okay the key basically is not known to the
attacker
oh
sorry
answer can why
can this approach work the key
okay very good so the idea is like this right so now
if oh here i should be bigger
so basically this key is known to add carrot to bob and uh so
we stand out the message like this carousel and empty so while
he receives this magic yes i mean he can produce another message
but he has to calculate this message hashtag the new political
reason you have to actually hash both messages and the key but in this case he
doesn't know the key she cannot produce the correct hatch
so bob will find out right when bubble receive it bubble will catch
this transmitter magic with the t
computer is different from this one because if you don't know the key you cannot
produce the cheat hash correctly is that right
makes sense okay
it's not this is the fault this is a not a encryption description
the purpose here is uh makes the integrity so that when you receive a message you can
find out if the message is changed or not so that's the purpose
yes that's a hybrid beauty magic integrity code
you can do that but that's a heavy guilty one okay because that one uses a public
equipment you have to do match but this one is using like a
hash algorithm it's very fast okay and that's why digital signature normally is used for
signature purpose it's really not for this one okay it's because it's for a really kind of different purpose
you are using this every day when you use the https to browse a website and uh all your messages
how this makes the interior code so that the receiver i mean the receiving computer of the single app knows okay
the message is uh generally not changed all your messages have that one okay if
you are doing this every day although you don't know okay and uh so
that's the idea any question here good okay okay we are pretty much done with the
hash i just wanted to use there's a someone you know what is basically before encoding telling you it's really
nothing okay so as we know right and uh when we talk about the
computer all the message is in this kind of a binary format
right okay and uh so here you know we use the asking code the particular
kind of sequence of binary members to represent the characters but
many of the data right other members not the students of uh ask people
characters they are not printable but because they are not english letters they are not printable
letters okay however sometimes we won't
send the data in a printable format we used
our shadow server our trader server can only send out printable letters
so the question here is how we convert any banner number
of final data into printable letters
base 64 in kodi is one approach so what happens is uh
the basic d4 does this it doesn't care about what your data means here
right your data is very long right or something like this so
basically always do that it will take six letters
another six letters here it will actually look at the six letter
six numbers right six numbers final numbers and you can convert this into a
decimal number tell me if it is a six bits here
how many possibilities do we have here if it's six bits how many possible
six beats can we have um
64 right true to power for six right and the b64 is so simple it has a list
of offers 64 printable captures
right so for example if this is a like a 10 it will find this okay 1 2 3 4 5 6
this number okay so this 64 accurate just go through your
binary data and it will convert every six bits
to one of those 64
chapters not simple so in this way you know and
now your banner data is printable because we are using printable letters
to represent the banner data of course you can do the reverse match right you can map
your 164 input data back to the binary using the
reverse match and then there's another thing called the
base 16 it just actually converts every small bit
to 16 printable letters from 0 to 9 from 3
to f so that's 16. so the purpose is uh to convert the
final data into printable characters so that's about the basic for basic theme
good now it's hands-on time and uh hands-on one is we do md5 hash
right and uh you can see here it's very easy you just use the icon as a command
okay and then remember here you don't have that the entire return so you map this
message to empty file style this is called the version right and uh so
then you will produce md5 of the magic and i recommend that you guys actually
use the chat server to do this the one person actually sends out a message and a
message attached in this format or format you choose whatever so you should tell which part is managing which part
except the corresponding message hash right and the receiver will receive it
the receiver can use the same command here to actually cache
the received message to uh amd file patch right
and uh
if they are the same means that the message is not changed but as we said it is not secure and
that's why we are going to use each mac this mac is one way of peel hash the idea is exact
same as kid hash it is one type of computer hash and in this case you first have to share
a key a stream whatever with uh your receiver okay and then to send the
receiver the first share key whatever then you use this command again
to anchor your message at this time this is a lot of traffic
in addition to mp5 right now here we go we are going to do each map
and this message to generate the metric hash so you'll do the same thing
as we did for md file cache using the chat server good right simple
and password cracking here and uh the possible cracking here you know very simple this is how you private password
and uh so on your calligram okay with our particular file the file must
be in a particular form the hash must be format otherwise how can this software
john reaper know which one which part is a possible hash right so that's why
we said again uh format um protocols
you know in computers they are computers so you have to set up a protocol so that
applications programs can understand each other that's why we talk about the format
protocols so much otherwise how can two programs talk to talk with each other right so
that's why we need a protocol and a format so once you have the password file here
you can just use this command john to crack the password
you'll be amazed this is how fast it can do in no time if you are using adc one two
three password and then one two three four six seven nine if we are using those one new password
it just give you the answer actually in no time okay
because this is a computer right and it can it can does the tedious enumeration very fast
and uh but anyway here there's another one is a you know after you actually use
a general recurve tracking the password file and actually everything's safe okay the
results are safe if you want to see your previous results you can use a job that shows my password
so this is the corresponding password file it will show you the previous uh results okay if you want to redo it
okay and you have to delete the same information so this is how you do it you
actually are on this spot can anybody tell me what the what
this means this is this produce symbol here what does this mean
anybody knows what that is currently single mean
because that's the user you use to log into chat right that's why it's called home
folder okay the user's locking user home folder and uh that's dashboard server
and uh actually uh this file is a student and this
folder don't jump here so what do you thought this means here
anybody knows what does dot mean here
stop is a perfect way to name a folder or file so if you have the dot
in front of your folder or your file is hidden if you
just use ls you cannot see it so this is one way to actually
hide some content you don't want the people to see or you just don't want to mess up
some important data you can you can you can just hide it so that people will not accidentally delete it right change it
and so it's in a hidden folder and uh the file name is john.
okay so also you can test your own password this is a an actual uh
challenge right and you can read it so everything's here
oh i have everything here
so it's in our where here right and uh oh we are almost done
oh my goodness so look at here here i have more
information and then you can follow it but make sure you understand the concepts right and uh yeah and time for
snack i know you are tired

## Hands-on

### Hands-on 1: MD5 Hash

#### One student as Sender
- Compute hash of a *message* you choose
```
echo -n "message" | md5sum
```
- Send message and its hash via chat server in the format of message>>>hash or chosen format to ensure you can tell which part is message and which part is hash.

#### Another student as Receiver
- Compute hash of received message locally (md5sum)
```
echo -n "received-message" | md5sum
```
Replace *received-message* with the actual message that was sent over
- Compare newly computed hash with the hash sent over
- Discuss why hash only is not good for message integrity verification

### Hands-on 2: HMAC
#### One student as Sender
- Share a secret key (a string) with Receiver offline (e.g., Discord private chat)
- Compute hmac of a message
```
echo -n "message" | openssl sha1 -hmac "key"
```
*sha1* refers to the sha1 hash algorithm; *key* is the chosen key.
- Send the message and hmac via the chat server in the format of message>>>hmac or your chosen format 

#### Another student with the key as Receiver
- Compute hmac of received message locally
```
echo -n "received-message" | openssl sha1 -hmac "key"
```
- Compare newly computed hmac with the received hmac

## Hands-on 3: Password Cracking
John the ripper---password cracking tool. Refer to <a href="https://www.openwall.com/john/doc/EXAMPLES.shtml">Example use</a>

Run the following command, where */home/kali/GenCyber/john/mypasswd* is the password hash file in the required format, to crack password hashes and obtain original password.
```
john mypasswd
```
Note: This command will try the *single crack* mode first, then use a wordlist (i.e. a dictionary of password; default password list at /usr/share/john/password.lst), and finally go for "incremental" mode
Please refer to MODES for more information on these modes.

If you ran the command before and got some passwords cracked, use the following command to show cracked passwords
```
john --show mypasswd
```
- Cracked passwords are stored in $JOHN/john.pot (~/.john/john.pot in kali) in a specific format.
- Delete john.pot in order to crack again
```
rm ~/.john/john.pot
```

### Hands-on 4: Cracking your own password
- Test security of your own password
Create your password hash by replacing abc123 below with your own password
```
openssl passwd -1 -salt RnYtvEVV abc123
```
*-1* specifies password hash format. 

This command will create something like the following: $1$xyz$X5pC0RUqKE5mOgXcDDgFk0.
Replace the corresponding part of one user password hash data in *mypasswd* using the result and run the following command again.
```
john mypasswd
```
